<!DOCTYPE HTML>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<title>Creative Growth</title>
		<style type="text/css">
		
		body {
			margin: 0;
			padding: 0;
			font-family: Arial;
			background-image: url('images/tiledbg.jpg');
		}
		
		header {
			position: relative;
			background-image: url('images/header.jpg');
			width: 710px;
			height: 140px;
			padding: 25px 270px 0 44px;
			color: white;
			font-size: 24px;
			font-weight: bold;
		}
		
		#factory-logo {
			position: absolute;
			right: 20px;
			top: 20px;
		}
		
		#main {   
			margin: 0 auto;
			width: 1024px;
			color: #000;
/*			line-height: 130%;*/
		}

		.qa {
			margin:0px;
			padding-left: 550px;
			padding-top: 70px;
			padding-bottom: 20px;
			background-image:url("images/BG_001.jpg");
			background-repeat: no-repeat;
			max-height: 550px;
			width: 474px;
			display: none;
			opacity: 0;
		}
		
		.qa.active {
			display: block;
			opacity: 1;
		}
		
		#question-1 {
			background-image:url("images/BG_002.jpg");
		}
		
		#question-2 {
			background-image:url("images/BG_003.jpg");
		}
		
		#question-3 {
			background-image:url("images/BG_004.jpg");
		}
		
		.qa .info {
			font-size: 24px;
			margin: 19px 0;
		}
		
		.qa .question {
			font-weight: bold;
			font-size: 24px;
			margin: 16px 0;
		}
		
		.qa input[type=text] {
			background-image:url('images/textbox.png');
			background-repeat: no-repeat;
			background-position: center left;
			padding-left: 5px;
			width: 420px;
			height: 19px;
			font-size: 14px;
			box-shadow: 3px 3px 3px #777;
		}
		
		.qa .next {
			background: url("images/arrow.png") no-repeat scroll right top transparent;
			display: block;
			height: 16px;
			line-height: 16px;
			margin-left: 363px;
			margin-top: 15px;
			vertical-align: top;
			width: 57px;
			cursor:pointer;
		}

		.qa .next:hover {
			background-position: right -16px;
			color: #03aa4c;
		}
		
		.qa .pgnumber {
			color: #03aa4c;
			font-size: 50px;
			font-weight: bold;
			padding: 170px 0px 0px 290px;
		}

		#container {
			position: relative;
			max-width: 100%;
			max-height: 100%;
			overflow: hidden;
		}

		#container > div.fkb {
			position: absolute;
			top: 0;
			left: 0;
		}
		
		#container > div.video-js-box {
			position: static;
		}

		#video {
			width: 100%;
			max-height: 100%;
		}
		
		.vjs-big-play-button {
			visibility: hidden;
		}
/*		
		#form {
			position: absolute;
			height: 100px;
			width: 220px;
			top: 40%;
			left: 50%;
			margin: -50px 0 0 -110px;
			background-color: white;
			border: 4px solid gray;
			padding: 0 20px;
		}
*/
		footer {
			color: #c1c1c1;
			padding: 10px;
			font-size: 0.9em;
			text-align: right;
			margin: 0px;
			background-image:url('images/footer.jpg');
		}
		
		footer a {
			text-decoration: none;
			color: #c1c1c1;
		}
		
		footer a:hover {
			text-decoration: underline;
			color: #c1c1c1;
		}
		
		</style>
		<link rel="stylesheet" href="css/video-js.css" type="text/css" media="screen" title="Video JS">
    <script>
window.butterProjectJSON = [{
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 90.3003,
        "end": 93.83416666666666,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "",
    "popcornOptions": {
        "start": 93.8008,
        "end": 86.90090000000001
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 96.06673333333333,
        "end": 98.4004,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [-5, -5, 110, 110],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 101.26693333333333,
        "end": 103.66733333333333,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 106.1001,
        "end": 108.7007,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [-5, -5, 110, 110],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 108.7007,
        "end": 112.36703333333334,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 122.86753333333333,
        "end": 126.46713333333334,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "1"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 126.46713333333334,
        "end": 129.86753333333334,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 141,
        "end": 143.1001,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [-5, -5, 110, 110],
        "question": "2"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 153.8008,
        "end": 157.93426666666667,
        "startPosition": [-5, -5, 110, 110],
        "endPosition": [0, 0, 100, 100],
        "question": "0"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 162.8008,
        "end": 164.83416666666668,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [-5, -5, 110, 110],
        "question": "2"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 184.3003,
        "end": 186.6006,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 188.13346666666666,
        "end": 189.3003,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 190.53386666666665,
        "end": 191.83416666666668,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 193.13346666666666,
        "end": 194.33366666666666,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 195.56723333333332,
        "end": 196.86753333333334,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 198.26693333333333,
        "end": 199.33366666666666,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 200.73406666666668,
        "end": 202.03336666666667,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 203.3003,
        "end": 206.46713333333332,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [0, 0, 100, 100],
        "question": "3"
    },
    "track": {}
}, {
    "start": 0,
    "end": 0,
    "type": "fkb",
    "popcornOptions": {
        "start": 114.48450916218309,
        "end": 117.58775226767814,
        "startPosition": [0, 0, 100, 100],
        "endPosition": [-5, -5, 110, 110],
        "question": "1"
    },
    "track": {}
}];
    </script>
		<script type="text/javascript">
			if (window.parent) {
				document.write('<script src="../../../lib/butter.js"><' + '/script>');
			}
	
		</script>
	</head>
	<body>
		<div id="main">
			<header><img src="images/cglogo.jpg" alt="Creative Growth"/> is an art center for mentally, physically and emotionally disabled artists. The Creative Growth staff work to create a positive space in order to foster creative and personal expression for the artists.<img src="images/tflogo.png" alt="The Factory" id="factory-logo"/>
			</header>

			<section class="qa active" id="question-0">
				<div class="info">Answer the following questions to personalize your viewing experience</div>
				<div class="question">What is something you wish you knew how to do?</div>		
				<input type="text" id="answer-0">
				<div class="next">Next</div>
				<div class="pgnumber">1 of 4</div>
			</section>

			<section class="qa" id="question-1">
				<div class="info">Answer the following questions<br/>to personalize your viewing experience</div>
				<div class="question">How do you express yourself?</div>		
				<input type="text" id="answer-1">
				<div class="next">Next</div>
				<div class="pgnumber">2 of 4</div>
			</section>

			<section class="qa" id="question-2">
				<div class="info">Answer the following questions<br/>to personalize your viewing experience</div>
				<div class="question">What do you find beautiful?</div>		
				<input type="text" id="answer-2">
				<div class="next">Next</div>
				<div class="pgnumber">3 of 4</div>
			</section>

			<section class="qa" id="question-3">
				<div class="info">Answer the following questions<br/>to personalize your viewing experience</div>
				<div class="question">What character, animal or artist represents you?</div>		
				<input type="text" id="answer-3">
				<div class="next">Next</div>
				<div class="pgnumber">4 of 4</div>
			</section>

			<div id="container" style="display: none" data-butter="target" class="video-js-box">
				<video id="video" preload="auto" autobuffer controls data-butter="media" class="video-js">
					<source src="http://videos-origin.mozilla.org/serv/webmademovies/bavc/creativegrowth.mp4" type='video/mp4; codecs="avc1.42E01E, mp4a.40.2"' />
					<source src="http://videos-origin.mozilla.org/serv/webmademovies/bavc/creativegrowth.webm" type='video/webm; codecs="vp8, vorbis"' />
				</video>
			</div><!-- container -->
			<footer>
				<a href="http://www.mozilla.org">Learn More</a> | <a href="http://www.bavc.org">Contact </a>
			</footer>
		</div><!-- main -->
	</body>
	<script src="js/video.js" type="text/javascript" charset="utf-8"></script>
	<script type="text/javascript" src="../popcorn-js/popcorn.js"></script>
	<script type="text/javascript" src="js/popcorn.flickr.kenburns.js"></script>
	<script type="text/javascript">
	
	(function() {
		
		
		var questions = [
			'What is something you wish you could do?',
			'How do you express yourself?',
			'What do you find beautiful?',
			'What character, animal or artist represents you?'
		];
		
		var answers = [
			'play piano',
			'filmmaking',
			'niagara falls',
			'harry potter'
		];
	
		var popcorn = Popcorn('#video', { frameAnimation: true } );
		
		//get list of photos from flickr
		var apikey = '3b1a167af8d3b3a1874f50fba0860093';
		
		var toLoad = 0, loaded = 0;
		var flickrData = {};
		var flickrPages = {};
		var time = 0.5;
		var r = Math.random;
		var container = document.getElementById('container');
		var popcornEventIds = {};
		var optionses = {};
		var optionsCount = 0;
		var videoAspect = 16/9;
		var videoSetup = false;
		
		document.getElementById('video').addEventListener('play', function() {
			if (!videoSetup) {
				videoSetup = true;
				container.style.display = '';
				VideoJS.setupAllWhenReady();
			}
		}, false);
		
		function loadEvent(butterId, options) {
			deleteEvent(butterId);

			options.onLoad = 'imageLoaded';
			options.apikey = apikey;
			options.butterId = butterId;
			options.target = 'container';
			
			if (options.startPosition) {
				options.aspect = videoAspect * options.startPosition[2] / options.startPosition[3];
			}

			optionses[butterId] = options;
			optionsCount++;
			toLoad++;

			
			load();
		}
		
		function deleteEvent(butterId) {
			var options = optionses[butterId];
			
			var popcornEventId = popcornEventIds[butterId];
			
			if (options && options.flickrData) {
				//return flickrData to appropriate list
				
				flickrData[options.question].splice(0, 0, options.flickrData);
				
			}
			
			if (options) {
				delete optionses[butterId];
				toLoad--;
				optionsCount--;
			}

			if (popcornEventId) {
				popcorn.removeTrackEvent( popcornEventId );

				delete popcornEventIds[butterId];
			}
		}
		
		window.imageLoaded = function (option) {
			toLoad--;
			loaded++;
			if (loaded >= optionsCount) {
				if (!videoSetup ) {
					videoSetup = true;
					container.style.display = '';
					VideoJS.setupAllWhenReady();
					//popcorn.play();
				}
				load();
			}
		}
		
		function load() {
			var i, options,
				found = 0,
				j, photo, c = 0,
				search, fd;

			for (i in optionses) {
				options = optionses[i];
				if (options.flickrData) {
					found++;
					/*
					if (!videoSetup && (found > 5 || found >= optionsCount) ) {
						videoSetup = true;
						VideoJS.setupAllWhenReady();
						container
					}
					*/
				} else if (options.aspect) {
					fd = flickrData[options.question];
					if (fd) {
						for (j = 0, c = 0; c < 1 && j < fd.length; j++) {
							if (fd[j].aspect && Math.abs(options.aspect - fd[j].aspect) < 0.3) {
								options.id = fd[j].id;
								options.flickrData = fd[j];
								
								fd.splice(j, 1);
								j--;
								
								//FINALLY got the info we need, so add to popcorn
								popcorn.fkb( options );
								var popcornEventId = popcorn.getLastTrackEventId();
								popcornEventIds[options.butterId] = popcornEventId;

								break;

							} else if (!fd[j].sizeRequested) {
								(function(d) {
									var url = 'http://api.flickr.com/services/rest/?method=flickr.photos.getSizes&api_key=' + apikey +
										"&photo_id=" + d.id + "&lang=en-us&format=json&jsoncallback=flickr_photo" + Date.now();
									Popcorn.xhr.getJSONP( url, function( data ) {
										if (!data || data.stat !== 'ok') {
											return;
										}

										var size = data.sizes.size.pop();
										d.height = size.height;
										d.width = size.width;
										d.aspect = size.width / size.height;
										
										load();
									});
									
									d.sizeRequested = true;
								}(fd[j]));
								
								c++;
							}
						}
					}
				}
			}
			
		}

		//document.getElementById('go').disabled = false;

		function doSearch() {
			var search, i;

			//document.getElementById('form').style.display = 'none';
			
			for (i = 0; i < answers.length; i++) {
				search = answers[i];

				if (!search) {
					break;
				}
				
	
				this.disabled = true;
	
				(function (s, index) {
					if (!flickrData[index]) {
						flickrData[index] = [];
					}
					
					if (!flickrPages[index]) {
						flickrPages[index] = 1;
					}

					var url = 'http://api.flickr.com/services/rest/?lang=en-us&format=json&method=flickr.photos.search&api_key=' + apikey + '&text=' + encodeURIComponent(search) + '&safe_search=1&sort=relevance&page=' + flickrPages[index] + '&jsoncallback=flickr' + i;
					flickrPages[index]++;

					Popcorn.xhr.getJSONP( url, function( data ) {
						if (!data.photos) {
							return;
						}
											
						flickrData[index] = flickrData[index].concat(data.photos.photo);
						load();
					});
				}(search, i));
			}
		}

    if ( window.butterProjectJSON ) {
      for ( var i=0, l=window.butterProjectJSON.length; i<l; ++i ) {
				loadEvent(i, Popcorn.extend( {}, window.butterProjectJSON[ i ].popcornOptions ) );
      }
    }
		else if (window.Butter) {

			var butterTracks = {};

			var b = new Butter();
			b.comm();

			var commClient = new b.CommClient( "previewerClient" );

			commClient.listen( "ping", function( message ) {
				commClient.send( Popcorn.instances.indexOf( popcorn ), "pong" );
			});

			commClient.listen( "trackeventadded", function ( message ) {
			
				var butterId = message.id;
				
				loadEvent(butterId, Popcorn.extend( {}, message.popcornOptions ) );
			
				var popcornEventId = popcorn.getLastTrackEventId();

				//commClient.send( { butterId: message.id, popcornId: popcornEventId }, "trackeventadded" );
			});

			commClient.listen( "trackeventupdated", function ( message ) {
				var butterId = message.id;
				var popcornEventId = butterTracks[butterId]
				
				//if ( popcornEventId ) {
					deleteEvent(butterId);

					loadEvent(butterId, Popcorn.extend( {}, message.popcornOptions ) );

					//butterTracks[butterId] = popcornEventId;

				//}
			});
		
			commClient.listen( "trackeventremoved", function ( message ) {
				var butterId = message.id;
				deleteEvent(butterId);
			});

			videoSetup = true;
			container.style.display = '';
			VideoJS.setupAllWhenReady();

		} else {
			loadEvent(0, {
				start: 1,
				end: 4,
				question: 1,
				target: 'container',
				startPosition: [0, 0, 100, 100],
				endPosition: [-10, -10, 120, 120],
				onLoad: 'imageLoaded'
			});
		}
		
		//doSearch();

		//document.getElementById('go').addEventListener('click', doSearch, false);

    var sectionNexts = document.getElementsByClassName('next'),
        sections = document.getElementsByClassName('qa');
    for ( var i=0; i<sectionNexts.length; ++i ) {
      sectionNexts[ i ].addEventListener( 'click', (function( idx ) {
        return function ( e ) {
          sections[ idx ].className = 'qa';
          answers[ idx ] = sections[ idx ].getElementsByTagName( 'input' )[ 0 ].value;
          if ( idx < sections.length - 1) {
            sections[ idx + 1 ].className = 'qa active';
          }
          else {
            //document.getElementById( 'container' ).style.display = "block";
		        doSearch();
            Popcorn.instances[ 0 ].play();
          }
        };
      })(i), false );
    }
	}());
	
	</script>
</html>
