<!DOCTYPE HTML>
<html lang="en-US">
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
		
		/*
			styles borrowed from takepart.com
		*/
		
		body {
			background: none repeat scroll 0 0 #FFFFFF;
			color: #333333;
			font-family: Helvetica,Arial,sans-serif;
			font-size: 12px;
			margin: 0;
			padding: 0;
		}
		
		#page-wrapper {
			margin: 0 auto;
			width: 980px;
		}
		
		.page {
			padding: 35px 20px;
		}

		.clearfix {
			display: block;
		}
		
		/*
			begin custom styles for Popcorn/Seriously
		*/
		
		#scale-buttons {
			position: fixed;
			right: 35px;
			background-color: #eee;
			padding: 20px;
			z-index: 1000;
		}

		#video-container {
			position: relative;
		}
		
		#video-container #canvas {
			position: absolute;
			top: 0;
			left: 0;
			pointer-events: none;
			z-index: 100;
			width: 100%;
		}
		
		#video-container .vjs-big-play-button,
		#video-container .vjs-controls,
		#video-container .vjs-styles-check {
			z-index: 202;
		}
		
		#video-container .vjs-spinner {
			z-index: 201;
		}
		
		/* disable full screen button */
		#video-container .vjs-fullscreen-control {
			display: none;
		}
		#video-container .vjs-volume-control {
			right: 10px;
		}
		#video-container .vjs-time-control {
			right: 65px;
		}
		#video-container .vjs-progress-control {
			right: 140px;
		}

		#video-container .popcorn-words {
			z-index: 1;
		}

		#video-container .popcorn-words.front {
			z-index: 120;
		}

		#video-container video {
			display: none;
		}
		
		#share-title {
			color: #666666;
			font-size: 16px;
			font-weight: bold;
			margin: 8px;
		}
		
		#tweet > p {
			border: 4px solid #CACACA;
			border-radius: 8px 8px 8px 8px;
			font-size: 16px;
			margin: 2px 0;
			padding: 17px;
		}

		/*
			Fonts
		*/
		@import url(http://fonts.googleapis.com/css?family=Rokkitt|Oswald);
		
		#video-container {
			font-family: 'Rokkitt', serif;
			font-size: 40px;
			line-height: normal;
			color: red;
		}

		#video-container > div {
			line-height: normal;
		}

		#video-container .title {
			font-family: 'Oswald', sans-serif;
			font-size: 46px;
			padding: 2px 6px;
			background-color: white;
			color: black;
		}
		
		</style>
		<link rel="stylesheet" href="css/video-js.css" type="text/css" media="screen" title="Video JS">
		<script type="text/javascript">
			if (window.parent) {
				document.write('<script src="../../../lib/butter.js"><' + '/script>');
			}
	
		</script>
	</head>
	<body>
		<div id="scale-buttons">
			<button id="smaller">-</button>
			<button id="actual-size">1x</button>
			<button id="bigger">+</button>
		</div>
		<div id="page-wrapper">
			<div id="page" class="page clearfix">
				<div id="video-container" class="video-js-box" data-butter="target">
					<div id="text-container" data-butter="target"></div>
					<canvas id="canvas"></canvas>
					<video id="video" preload class="video-js" data-butter="media">
						<source src="video/knell.webm" type='video/webm; codecs="vp8, vorbis"'/>
						<source src="video/knell.mp4" type='video/mp4'/>
					</video>
				</div>
				<!--
				<br/><input type="range" min="0" max="1" step="0.0001" value="0.7963" id="clipBlack"/>
				<br/><input type="range" min="0" max="1" step="0.0001" value="0.8545" id="clipWhite"/>
				-->
				<p id="share-title">Share this link with your followers</p>
				<div id="tweet" data-butter="target">
					<p>Seen this? the world according to your mom</p>
				</div>
			</div>
		</div>
	</body>
	<script type="text/javascript" src="lib/html5slider.js"></script>
	<script type="text/javascript" src="lib/video.js"></script>
	<script type="text/javascript" src="external/seriously.js"></script>
	<script type="text/javascript" src="external/seriously.lumakey.js"></script>
	<script type="text/javascript" src="external/popcorn.js"></script>
	<script type="text/javascript" src="js/popcorn.words.js"></script>
	<script type="text/javascript" src="js/popcorn.lumakey.js"></script>
	<script type="text/javascript">
	
	window.addEventListener('DOMContentLoaded', function() {
	
		//todo: enable smaller/bigger buttons only when in Popcorn Maker
		if (window.parent) {
			var scale = 1;
			function setScale(n) {
				var page = document.getElementById('page'),
					p,
					transform,
					properties = ['webkitTransform', 'MozTransform', 'ieTransform', 'oTransform', 'transform'];
				
				scale = Math.max(Math.min(n, 2), 0.1);
				
				if (scale === 1) {
					transform = '';
				} else {
					transform = 'scale(' + scale + ')';
				}
	
				for (p = 0; p < properties.length; p++) {
					page.style[ properties[p] ] = transform;
					page.style[ properties[p] + 'Origin'] = 'top left';
				}
				
				if (window.localStorage && localStorage.setItem) {
					localStorage.setItem('popcornMakerZoomScale', scale);
				}
			}
			
			document.getElementById('smaller').addEventListener('click', function() {
				setScale(scale - 0.1);
			}, false);
		
			document.getElementById('actual-size').addEventListener('click', function() {
				setScale(1);
			}, false);
		
			document.getElementById('bigger').addEventListener('click', function() {
				setScale(scale + 0.1);
			}, false);

			if (window.localStorage &&
				window.localStorage.getItem &&
				!isNaN(localStorage.popcornMakerZoomScale)) {
				setScale(localStorage.popcornMakerZoomScale);
			}
		}
		
		var video = document.getElementById('video');
		function setUpVideoSize() {
			var videoJS = VideoJS.setup('video');
			videoJS.width(940);
			videoJS.height(940 * video.videoHeight / video.videoWidth);
			video.style.display = 'none';
		}
		
		if (video.videoWidth) {
			setUpVideoSize();
		} else {
			video.addEventListener('loadedmetadata', setUpVideoSize, false);
		}
		
		var popcorn = Popcorn('#video', { frameAnimation: true });

		if (window.Butter) {

			var butterTracks = {};

			var b = new Butter();
			b.comm();

			var commClient = new b.CommClient( "previewerClient"  );

			//var interval = setInterval(function() {
				commClient.listen( "ping", function( message ) {
					//clearInterval(interval);
					commClient.send( Popcorn.instances.indexOf( popcorn ), "pong" );
					//commClient.forget('ping');
				});
			//}, 10);

			commClient.listen( "trackeventadded", function ( message ) {
			
				var butterId = message.id;
				
				//add callbacks
				var options = Popcorn.extend( {}, message.popcornOptions );
				
				popcorn[ message.type ]( options ); 
			
				var popcornEventId = popcorn.getLastTrackEventId();
				
				butterTracks[butterId] = popcornEventId;

				commClient.send( { butterId: message.id, popcornId: popcornEventId }, "trackeventadded" );				
			});

			commClient.listen( "trackeventupdated", function ( message ) {
				var butterId = message.id;
				var popcornEventId = butterTracks[butterId]
				
				if ( popcornEventId ) {
					popcorn.removeTrackEvent( popcornEventId );

					//add callbacks
					var options = Popcorn.extend( {}, message.popcornOptions );
					
					popcorn[ message.type ]( options );
					popcornEventId = popcorn.getLastTrackEventId();
					
					butterTracks[butterId] = popcornEventId;

				}
			});
		
			commClient.listen( "trackeventremoved", function ( message ) {
				var butterId = message.id;
				var popcornEventId = butterTracks[butterId]
				
				if ( popcornEventId ) {
					popcorn.removeTrackEvent( popcornEventId );
					delete butterTracks[butterId];
				}
			});
		}

		if (window.butterProjectJSON) {
		} else {
	/*
			
			p.words({
				start: 3,
				end: 8,
				target: 'in-back',
				text: 'here are some words\nand more words',
				top: '10%',
				left: '5%'
			});
		*/
		}
		
		//luma key events are hard coded in for now
		if (!window.parent || window.parent === window) {
			popcorn.lumakey({
				start: 2,
				end: 10.125,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
			
			popcorn.lumakey({
				start: 15.375,
				end: 32.125,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 35.375,
				end: 1006/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 35.375,
				end: 1006/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 1043/23,
				end: 1278/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 1323/23,
				end: 1416/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 1453/23,
				end: 1671/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 1725/23,
				end: 1887/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			popcorn.lumakey({
				start: 1922/23,
				end: 2410/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
	
			//empty white section near the end
			popcorn.lumakey({
				start: 2485/23,
				end: 2600/24,
				target: 'video-container',
				clipBlack: 0.7963,
				clipWhite: 0.8545
			});
		}

	}, false);
	
	</script>
</html>