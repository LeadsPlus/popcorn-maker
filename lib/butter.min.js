(function(t,r,k){var v=0,h=function(a){var c=[],b=v++,d=k,f=this,a=a||{},p=a.name||"Track"+Date.now();this.getName=function(){return p};this.getId=function(){return b};this.getTrackEvent=function(b){for(var a=0,f=c.length;a<f;++a)if(c[a].getId()===b||c[a].getName()===b)return c[a]};this.getTrackEvents=function(){return c};this.removeTrackEvent=function(b){typeof b==="string"&&(b=f.getTrackEvent(b));var a=c.indexOf(b);if(a>-1)c.splice(a,1),b.track=k,b.setButter(k),d.trigger("trackeventremoved",b)};
this.addTrackEvent=function(b){b instanceof e||(b=new e(b));c.push(b);b.track=f;d&&b.setButter(d);return b};this.setButter=function(b){if(d=b){d.trigger("trackadded",f);for(var b=f.getTrackEvents(),c=0,a=b.length;c<a;++c)b[c].setButter(d)}};this.getButter=function(){return d};this.importJSON=function(b){if(b.name)p=b.name;if(b.trackEvents)for(var b=b.trackEvents,c=0,a=b.length;c<a;++c){var q=new e;q.importJSON(b[c]);f.addTrackEvent(q)}};this.exportJSON=function(){for(var b=[],a=0,f=c.length;a<f;++a)b.push(c[a].exportJSON());
return{name:p,trackEvents:b}}},o=0,e=function(a){var c=o++,b=k,d=this,a=a||{},f=a.name||"Track"+Date.now();this.start=a.start||0;this.end=a.end||0;this.type=a.type;this.popcornOptions=a.popcornOptions;this.popcornEvent=a.popcornEvent;this.track=a.track;this.getName=function(){return f};this.getId=function(){return c};this.setButter=function(c){(b=c)&&b.trigger("trackeventadded",d)};this.getButter=function(){return b};this.importJSON=function(b){this.start=b.start||0;this.end=b.end||0;this.type=b.type;
if(b.name)f=b.name;this.popcornOptions=b.popcornOptions};this.exportJSON=function(){return{start:this.start,end:this.end,type:this.type,popcornOptions:this.popcornOptions,track:this.track?this.track.getName():k,name:f}}},d=0,j=function(a){var c=d++,a=a||{},b=a.name||"Target"+c+Date.now();this.object=a.object;this.getName=function(){return b};this.getId=function(){return c};this.importJSON=function(c){if(c.name)b=c.name;this.object=c.object};this.exportJSON=function(){var c;try{c=JSON.stringify(this.object)}catch(a){c=
this.object.toString()}return{name:b,object:c}}},m=0,a=function(a){var a=a||{},c={},b=[],d=m++,f=a.name||"Media"+d+Date.now(),e,g,n=k,i=0,q=0,s=this;this.getUrl=function(){return e};this.getTarget=function(){return g};this.setUrl=function(b){e=b;n&&n.trigger("mediacontentchanged",s)};this.setTarget=function(b){g=b;n&&n.trigger("mediatargetchanged",s)};this.getName=function(){return f};this.getId=function(){return d};this.getTracks=function(){return b};this.setButter=function(b){if(n=b){n.trigger("mediaadded",
s);for(var b=s.getTracks(),c=0,a=b.length;c<a;++c)b[c].setButter(n)}};this.getButter=function(){return n};this.addTrack=function(a){a instanceof h||(a=new h(a));c[a.getName()]=a;b.push(a);n&&a.setButter(n);return a};this.getTrack=function(a){var q=c[a];if(q)return q;for(var q=0,f=b.length;q<f;++q)if(b[q].getName()===a)return b[q];return k};this.removeTrack=function(a){typeof a==="string"&&(a=s.getTrack(a));var q=b.indexOf(a);if(q>-1){b.splice(q,1);a.setButter(k);delete c[a.getName()];for(var q=a.getTrackEvents(),
f=0,d=q.length;f<d;++f)n.trigger("trackeventremoved",q[f]);n&&n.trigger("trackremoved",a);return a}return k};this.currentTime=function(a){a&&(i=a,n&&n.trigger("mediatimeupdate",s));return i};this.duration=function(a){a&&(q=a,n&&n.trigger("mediadurationchanged",s));return q};this.importJSON=function(a){if(a.name)f=a.name;a.target&&s.setTarget(a.target);a.url&&s.setUrl(a.url);if(a.tracks)for(var a=a.tracks,b=0,q=a.length;b<q;++b){var c=new h;c.importJSON(a[b]);s.addTrack(c)}};this.exportJSON=function(){for(var a=
[],c=0,s=b.length;c<s;++c)a.push(b[c].exportJSON());return{name:f,url:e,target:g,duration:q,tracks:a}};a.url&&this.setUrl(a.url);a.target&&this.setTarget(a.target)},u=0,g=function(){function d(){if(!f)throw Error("No media object is selected");}var c={},b=[],l={},f,p=[],m={},n={},i=this;this.id="Butter"+u++;this.trigger=function(a,b,f){b={type:a,domain:f,data:b};if(c[a])for(var d=0,e=c[a].length;d<e;++d)c[a][d].call(i,b,f);if(f&&(a+=f,c[a])){d=0;for(e=c[a].length;d<e;++d)c[a][d].call(i,b,f)}};this.listen=
function(a,b,f){a+=f||"";c[a]||(c[a]=[]);c[a].push(b)};this.unlisten=function(a,b,f){a+=f||"";if(f=c[a])b?(a=f.indexOf(b),f.splice(a,1)):c[a]=[]};this.addTrackEvent=function(a,b){d();typeof a==="string"&&(a=f.getTrack(a));if(a)return b instanceof e||(b=new e(b)),a.addTrackEvent(b),b;else throw Error("No valid track specified");};this.getTrackEvents=function(){d();for(var a=f.getTracks(),b={},c=0,e=a.length;c<e;++c){var i=a[c];b[i.getName()]=i.getTrackEvents()}return b};this.getTrackEvent=function(a,
b){d();if(a&&b)return typeof a==="string"&&(a=i.getTrack(a)),a.getTrackEvent(b);else{var c=i.getTrackEvents(),f;for(f in c)for(var e=c[f],l=0,g=e.length;l<g;++l)if(e[l].getName()===a)return e[l]}};this.removeTrackEvent=function(a,b){d();if(!b)if(a instanceof e)b=a,a=b.track;else if(typeof a==="string")b=i.getTrackEvent(a),a=b.track;else throw Error("Invalid parameters for removeTrackEvent");typeof a==="string"&&(a=i.getTrack(a));typeof b==="string"&&(b=a.getTrackEvent(b));a.removeTrackEvent(b);return b};
this.addTrack=function(a){d();return f.addTrack(a)};this.getTracks=function(){d();return f.getTracks()};this.getTrack=function(a){d();return f.getTrack(a)};this.removeTrack=function(a){d();return f.removeTrack(a)};this.addTarget=function(a){a instanceof j||(a=new j(a));m[a.getName()]=a;p.push(a);i.trigger("targetadded",a);return a};this.removeTarget=function(a){typeof a==="string"&&(a=i.getTarget(a));var b=p.indexOf(a);if(b>-1)return p.splice(b,1),delete p[a.getName()],i.trigger("targetremoved",a),
a;return k};this.getTargets=function(a){if(a){for(var a=[],b=0,c=p.length;b<c;++b)a.push(p[b].exportJSON());return a}else return p};this.getTarget=function(a){return m[a]};this.importProject=function(b){n=b.project;if(b.targets)for(var c=0,f=b.targets.length;c<f;++c){var d=new j;d.importJSON(b.targets[c]);i.addTarget(d)}if(b.media){c=0;for(f=b.media.length;c<f;++c)d=new a,d.importJSON(b.media[c]),i.addMedia(d)}};this.exportProject=function(){for(var a=[],c=0,f=b.length;c<f;++c)a.push(b[c].exportJSON());
return{project:n,targets:i.getTargets(!0),media:a}};this.setProjectDetails=function(a,b){n[a]=b};this.getProjectDetails=function(a){return a?n[a]:n};this.clearProject=function(){for(var a=i.getTracks(),b=i.getTargets(),c=i.getAllMedia(),f=0,d=a.length;f<d;f++)i.removeTrack(a[f]);f=0;for(d=b.length;f<d;f++)i.removeTarget(b[f]);f=0;for(d=c.length;f<d;f++)i.removeMedia(c[f])};this.currentTime=function(a){d();return f.currentTime(a)};this.duration=function(a){d();return f.duration(a)};this.getAllMedia=
function(){return b};this.getMedia=function(a){if(l[a])return l[a];for(var c=0,f=b.length;c<f;++c)if(b[c].getName()===a)return b[c];return k};this.getCurrentMedia=function(){return f};this.setMedia=function(a){typeof a==="string"&&(a=i.getMedia(a));if(a&&b.indexOf(a)>-1)return f=a,i.trigger("mediachanged",a),f};this.addMedia=function(c){c instanceof a||(c=new a(c));var d=c.getName();b.push(c);l[d]=c;c.setButter(i);f||i.setMedia(c);return c};this.removeMedia=function(a){typeof a==="string"&&(a=i.getMedia(a));
var c=b.indexOf(a);if(c>-1)return b.splice(c,1),delete l[a.getName()],a.setButter(k),a===f&&(f=k),i.trigger("mediaremoved",a),a;return k};this.extend=function(){g.extend(i,[].slice.call(arguments,1))}};g.getScriptLocation=function(){for(var a=r.querySelectorAll("script"),c=0;c<a.length;++c){var b=a[c].src.lastIndexOf("butter.js");if(b>-1)return a[c].src.substr(0,b)+"/"}};g.registerModule=g.prototype.registerModule=function(a,c){g.prototype[a]=function(a){c.call(this,a);return this};c.extend&&g.extendAPI(c.extend)};
g.extendAPI=function(a){for(var c in a)a.hasOwnProperty(c)&&(g[c]=a[c],g.prototype[c]=a[c])};g.extend=function(a){var c=a;[].slice.call(arguments,1).forEach(function(a){for(var d in a)c[d]=a[d]})};g.Media=a;g.Track=h;g.TrackEvent=e;g.Target=j;t.Butter=g})(window,document,void 0);(function(t,r,k){k.registerModule("comm",{setup:function(){},extend:{CommClient:function(k,h){var o={};t.addEventListener("message",function(e){if(e.source!==t){e=JSON.parse(e.data);if(e.type&&o[e.type])for(var d=o[e.type],j=0;j<d.length;++j)d[j](e.message);h&&h(e)}},!1);this.listen=function(e,d){if(e&&d)return o[e]||(o[e]=[]),o[e].push(d),d;else throw Error("Must provide a type and callback for CommClient listeners");};this.forget=function(e,d){if(d){var j=o[e].indexOf(d);if(j>-1)return d=o[e][j],
o.splice(j,1),d}else delete o[e]};this.send=function(e,d){d?postMessage(JSON.stringify({type:d,message:e}),"*"):postMessage(JSON.stringify(e),"*")}},CommServer:function(){function k(e,d,j){var m={};this.getName=function(){return e};this.listen=function(a,d){if(a&&d)return m[a]||(m[a]=[]),m[a].push(d),d;else throw Error("Must provide a type and callback for CommServer listeners");};this.forget=function(a,d){if(d){var e=m[a].indexOf(d);if(e>-1)return d=m[a][e],m.splice(e,1),d}else delete m[a]};this.send=
function(a,e){e?d.postMessage(JSON.stringify({type:e,message:a}),"*"):d.postMessage(JSON.stringify(a),"*")};d.addEventListener("message",function(a){if(a.source===d){a=JSON.parse(a.data);if(a.type&&m[a.type])for(var e=m[a.type],g=0;g<e.length;++g)e[g](a.message);j&&j(a)}},!1)}var h={},o=this;this.bindFrame=function(e,d,j,m){d.addEventListener("load",function(a){o.bindClientWindow(e,d.contentWindow,m);j&&j(a)},!1)};this.bindWindow=function(e,d,j,m){d.addEventListener("load",function(a){o.bindClientWindow(e,
d,m);j&&j(a)},!1)};this.bindClientWindow=function(e,d,j){h[e]=new k(e,d,j)};this.listen=function(e,d,j){h[e]&&h[e].listen(d,j)};this.forget=function(e,d,j){h[e]&&h[e].forget(d,j)};this.send=function(e,d,j){h[e]&&h[e].send(d,j)}}}})})(window,document,Butter);(function(t,r,k,v){v.registerModule("plugintray",function(h){var o=[],e=0,d,j=function(d){var a=e++,j=this,g=k,d=d||{},h=d.name||"Plugin"+Date.now();this.type=d.type;this.getName=function(){return h};this.getId=function(){return a};this.setButter=function(a){g=a};this.getButter=function(){return g};this.createElement=function(a){a?(a=a.replace(/\$type/g,j.type),a=$(a)[0]):(a=r.createElement("span"),a.innerHTML=j.type+" ");a.id=j.type;a.setAttribute("data-trackliner-type","butterapp");$(a).draggable({helper:"clone",
appendTo:"body",zIndex:9001,revert:!0,revertDuration:0});return a}},h=h||{};d=r.getElementById(h.target)||h.target;this.addPlugin=function(e){e instanceof j||(e=new j(e));o.push(e);e.setButter(this);this.trigger("pluginadded",e);var a=r.createElement("span");a.innerHTML=e.type+" ";a.id=e.type;a.setAttribute("data-trackliner-type","butterapp");$(a).draggable({helper:"clone",appendTo:"body",zIndex:9001,revert:!0,revertDuration:0});d.appendChild(a);return e};this.getPlugins=function(){return o}})})(window,
document,void 0,Butter);(function(t,r,k,v){k.registerModule("eventeditor",function(h){function o(b){function e(){a[m]("editorCommLink",f,function(){p.listen("trackeventupdated",n);p.listen("targetadded",function(){a.send("editorCommLink",p.getTargets(),"domtargetsupdated")});a.listen("editorCommLink","okayclicked",function(a){b.popcornOptions=a;f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);p.unlisten("trackeventupdated",n);p.trigger("trackeditclosed");p.trigger("trackeventupdated",b)});a.listen("editorCommLink",
"applyclicked",function(a){b.popcornOptions=a;p.trigger("trackeventupdated",b)});a.listen("editorCommLink","deleteclicked",function(){p.removeTrackEvent(b);f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);p.unlisten("trackeventupdated",n);p.trigger("trackeditclosed")});a.listen("editorCommLink","cancelclicked",function(){f.close&&f.close();f&&f.parentNode&&f.parentNode.removeChild(f);p.unlisten("trackeventupdated",n);p.trigger("trackeditclosed")});for(var c=p.getTargets(),d=[],e=0,
l=c.length;e<l;++e)d.push([c[e].getName(),c[e].getId()]);a.send("editorCommLink",{trackEvent:b,targets:d},"edittrackevent")})}var f,p=this,h=c[b.type]||b.manifest.customEditor||j,n=function(b){a.send("editorCommLink",b.data.popcornOptions,"updatetrackevent")};if(d)for(;d.firstChild;)d.removeChild(d.firstChild);if(m==="bindWindow")f=w||t.open(h,"","width="+g+",height="+u+",menubar=no,toolbar=no,location=no,status=no"),e(),f.addEventListener("beforeunload",function(){p.unlisten("trackeventupdated",
n);p.trigger("trackeditforcedclosed")},!1);else if(m==="bindFrame")f=r.createElement("iframe"),f.style.width=g,f.style.height=u,e(),f.src=h,d.appendChild(f)}function e(a,c){return{domtarget:function(a){if(typeof a==="string")return d=r.getElementById(a)||{};else if(a)return d=a},window:function(a){if(a)return w=a}}[c](a)}var d,j,m,a,u,g,w,c={};if(!h||typeof h!=="object")throw Error("Invalid Argument");g=h.editorWidth||400;u=h.editorHeight||400;h.target&&e(h.target,"domtarget")||h.targetWindow&&e(h.targetWindow,
"window");m=d?"bindFrame":"bindWindow";j=h.defaultEditor||"defaultEditor.html";a=new k.CommServer;this.editTrackEvent=function(a){if(!a||!(a instanceof k.TrackEvent))return!1;this.trigger("trackeditstarted");o.call(this,a);return!0};this.addCustomEditor=function(a,d){if(!d||!a)return!1;return c[d]=a};this.removeCustomEditor=function(a,d){if(!d||!a)return!1;var f=c[d];c[d]=v;return f};this.changeEditorTarget=function(a,c){var f=["domtarget","window"],g;if(!a)return d=v,m="bindWindow",!0;if(!c||f.indexOf(g=
c.toLowerCase())===-1)return!1;return e(a,g)};this.setDefaultEditor=function(a){if(!a||typeof a!=="string")return!1;return j=a};this.setEditorDims=function(a){if(!a||!a.height&&!a.width)return!1;g=a.width||g;u=a.height||u;return a}})})(window,window.document,Butter);(function(t,r,k,v){k.registerModule("previewer",function(h){var o,e,d,j,m,a,u,g,t,c;g={};u=h.popcornURL||"http://popcornjs.org/code/dist/popcorn-complete.js";o=/(?:http:\/\/www\.|http:\/\/|www\.|\.|^)(youtu|vimeo|soundcloud|baseplayer)/;t=h.layout;butterIds={};m=h.media;c={};a={};var b=this,l=r.getElementById(h.target);if(l.tagName==="DIV")target=r.getElementById(h.target),d=r.createElement("IFRAME"),d.src=t,d.width=target.style.width,d.height=target.style.height,target.appendChild(d),d.addEventListener("load",
function(){b.scraper(d,h.callback);this.removeEventListener("load",arguments.callee,!1)},!1);else if(l.tagName==="IFRAME")d=l,d.src=h.layout,l.addEventListener("load",function(){b.scraper(d,h.callback);this.removeEventListener("load",arguments.callee,!1)},!1);this.scraper=function(a,c){function d(a){for(var c=0;c<a.length;c++)a[c].getAttribute("data-butter")==="target"?b.addTarget({name:a[c].id,type:"target"}):a[c].getAttribute("data-butter")==="media"&&b.addMedia({target:a[c].id,url:m}),a[c].children.length>
0&&d(a[c].children)}var e=(a.contentWindow||a.contentDocument).document.getElementsByTagName("BODY");b=this;k.extend(g,(a.contentWindow||a.contentDocument).document.head);var i=function(){e.length<1?setTimeout(function(){i()},5):(d(e[0].children),c())};i()};this.buildPopcorn=function(b,g){e=b.getUrl();var l=(d.contentWindow||d.contentDocument).document;videoTarget=b.getTarget();l.getElementById(videoTarget).innerHTML="";j="document.addEventListener('DOMContentLoaded', function () {\n";var h=o.exec(e)||
"",i=[];i.youtu=function(){l.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.youtube( '"+videoTarget+"', '"+e+"', {\nwidth: 430, height: 300\n} ) );\n"};i["vimeo "]=function(){l.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.vimeo( '"+videoTarget+"', '"+e+"', {\ncss: {\nwidth: '430px',\nheight: '300px'\n}\n} ) );\n"};i.soundcloud=function(){l.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+
b.getId()+" = Popcorn( Popcorn.soundcloud( '"+videoTarget+"', '"+e+"' ) );\n"};i.baseplayer=function(){l.getElementById(videoTarget).innerHTML="";a[b.getId()]="popcorn"+b.getId()+" = Popcorn( Popcorn.baseplayer( '"+videoTarget+"' ) );\n"};i[v]=function(){var c=l.createElement("source"),d=l.createElement("video");c.src=e;d.style.width=l.getElementById(videoTarget).style.width;d.style.height=l.getElementById(videoTarget).style.height;d.appendChild(c);d.controls=!0;d.id=videoTarget+"-butter";l.getElementById(videoTarget).appendChild(d);
c="#"+d.id;a[b.getId()]="popcorn"+b.getId()+" = Popcorn( '"+c+"');\n"};i[h[1]]();for(video in a)j+=a[video];for(popcorn in c)if(h=c[popcorn].getTrackEvents())for(i=0;i<h.length;i++){var q=h[i]._natives.manifest.options;j+=" popcorn"+popcorn+"."+h[i]._natives.type+"({\n";for(item in q)q.hasOwnProperty(item)&&(j+=item+": '"+h[i][item]+"',\n");j+="});"}j+="}, false);";this.fillIframe(b,g)};this.getPopcorn=function(){var b="var "+a;for(popcorn in c){var d=c[popcorn].getTrackEvents();if(d)for(var e=0;e<
d.length;e++){var g=d[e]._natives.manifest.options;b+="popcorn"+popcorn+"."+d[e]._natives.type+"({\n";for(item in g)g.hasOwnProperty(item)&&(b+=item+": '"+d[e][item]+"',\n");b+="});\n"}}return b};this.getRegistry=function(){return(d.contentWindow||d.contentDocument).Popcorn.registry};this.fillIframe=function(a,b){var e,l,i=this,h=(d.contentWindow||d.contentDocument).document;e=h.createElement("script");e.innerHTML=j;h.head.appendChild(e);e="<head>"+g.innerHTML+"\n<script src='"+u+"'><\/script>\n<script>\n"+
j+"<\/script>";e+="\n</head>\n";l=h.body.innerHTML;h.open();h.write("<html>\n"+e+l+"\n</html>");h.close();var k=function(b,c){var e=(d.contentWindow||d.contentDocument)["popcorn"+a.getId()];e?c&&c(e):setTimeout(function(){k(b,c)},10)};k(null,function(c){var d=function(){c.media.readyState>=2||c.media.duration>0?(i.duration(c.media.duration),i.trigger("mediaready",a),c.media.addEventListener("timeupdate",function(){i.currentTime(c.media.currentTime);i.trigger("mediatimeupdate",a)},!1),b&&b()):setTimeout(function(){d(c)},
10)};d(c)});this.teAdded=function(e){var g=e.data;k(g,function(e){c[a.getId()]?e=c[a.getId()]:c[a.getId()]=e;e.removeTrackEvent(butterIds[g.getId()]);e[g.type]((d.contentWindow||d.contentDocument.parentWindow).Popcorn.extend({},g.popcornOptions));butterIds[g.getId()]=e.getLastTrackEventId();g.manifest=e.getTrackEvent(butterIds[g.getId()])._natives.manifest;b&&b()})};this.listen("trackeventupdated",function(a){this.teAdded(a)});this.listen("trackeventadded",function(b){b=b.data;k(b,function(e){c[a.getId()]?
e=c[a.getId()]:c[a.getId()]=e;e[b.type]((d.contentWindow||d.contentDocument).Popcorn.extend({},b.popcornOptions));butterIds[b.getId()]=e.getLastTrackEventId();b.manifest=e.getTrackEvent(butterIds[b.getId()])._natives.manifest})});this.listen("trackeventremoved",function(b){(d.contentWindow||d.contentDocument)["popcorn"+a.getId()].removeTrackEvent(butterIds[b.data.getId()])});this.listen("mediatimeupdate",function(b){d.contentWindow["popcorn"+a.getId()].currentTime(b.data.currentTime())},"timeline");
this.listen("mediachanged",function(){i.buildPopcorn(i.getCurrentMedia())})}})})(window,document,Butter);(function(t,r,k){k.registerModule("timeline",function(t){var h=function(a){var b=new Date(1970,0,1);b.setSeconds(a);a=b.toTimeString().substr(0,8);a>86399&&(a=Math.floor((b-Date.parse("1/1/70"))/36E5)+a.substr(2));return a},o=function(a){var b=curtop=0;if(a.offsetParent){do b+=a.offsetLeft,curtop+=a.offsetTop;while(a=a.offsetParent)}return[b,curtop]},e=!1,d=0,j=function(a){var b=this;this.container=r.createElement("div");this.container.style.width="100%";this.container.style.height="100%";this.container.style.position=
"relative";this.container.style.MozUserSelect="none";this.container.style.webkitUserSelect="none";this.container.style.oUserSelect="none";this.container.style.userSelect="none";u.appendChild(this.container);this.tracks=r.createElement("div");this.tracks.style.width="100%";this.tracks.style.height="100%";this.init=function(){this.duration=a.duration();this.trackLine=new TrackLiner({element:this.tracks,dynamicTrackCreation:!0,scale:1,duration:this.duration,restrictToKnownPlugins:!0});this.butterTracks=
{};this.trackLinerTracks={};this.butterTrackEvents={};this.trackLinerTrackEvents={};this.timeline=r.createElement("canvas");this.timeline.style.height="25px";this.timeline.style.width=this.container.offsetWidth+"px";this.timeline.height="25";this.timeline.width=this.container.offsetWidth;this.scrubber=r.createElement("div");this.scrubber.style.height="100%";this.scrubber.style.width="1px";this.scrubber.style.position="absolute";this.scrubber.style.top="0px";this.scrubber.style.left="0px";this.scrubber.style.zIndex=
this.timeline.style.zIndex+1;this.scrubber.style.backgroundColor="red";this.userInteract=r.createElement("div");this.userInteract.style.position="absolute";this.userInteract.style.top="0px";this.userInteract.style.left="0px";this.userInteract.style.height=this.timeline.style.height;this.userInteract.style.width="100%";this.userInteract.style.zIndex=this.scrubber.style.zIndex+1;this.userInteract.addEventListener("mousemove",function(a){d=a.rangeParent.scrollLeft},!1);this.userInteract.addEventListener("mousedown",
function(a){e=!0;g.currentTime((a.pageX-(b.container.offsetLeft-d)+b.container.scrollLeft-o(b.container)[0])/b.container.offsetWidth*b.duration);g.trigger("mediatimeupdate",g,"timeline")},!1);this.container.appendChild(this.scrubber);this.container.appendChild(this.userInteract);this.container.appendChild(this.timeline);this.container.appendChild(this.tracks);var l=this.timeline.getContext("2d"),f=this.container.offsetWidth/this.duration/4,j=[10,4,7,4],k=l.measureText(h(5)).width,m=-k/2;l.translate(0.5,
0.5);l.beginPath();for(var i=1,q=this.duration*4;i<q;i++){var s=i*f;l.moveTo(-~s,0);l.lineTo(-~s,j[i%4]);i%4===0&&s-m>k&&(m=s,l.fillText(h(i/4),-~s-k/2,21))}l.stroke();l.closePath()};this.hide=function(){this.container.style.display="none"};this.show=function(){this.container.style.display="block"}},m=[],a,u=r.getElementById(t.target)||t.target,g=this;TrackLiner.plugin("butterapp",{setup:function(c,b,d,e){if(e){d=c;if(!a.butterTracks[c.id()])a.trackLine.removeTrack(d),g.addTrack(new k.Track),d=a.lastTrack;
a.lastTrack=d;var d=b.left/a.container.offsetWidth*a.duration,h=d+4;g.addTrackEvent(a.butterTracks[a.lastTrack.id()],new k.TrackEvent({popcornOptions:{start:d,end:h},type:e.draggable[0].id}))}else return d=b.popcornOptions.start,h=b.popcornOptions.end,e=(h-d)/a.duration*c.getElement().offsetWidth,{left:d/a.duration*c.getElement().offsetWidth,innerHTML:b.type,width:e}},moved:function(c,b){var d=c;b.options.popcornOptions.start=b.element.offsetLeft/a.container.offsetWidth*a.duration;b.options.popcornOptions.end=
(b.element.offsetLeft+b.element.offsetWidth)/a.container.offsetWidth*a.duration;if(!a.butterTracks[c.id()])a.trackLine.removeTrack(d),g.addTrack(new k.Track),d=a.lastTrack,d.addTrackEvent(b);a.lastTrack=d;g.trigger("trackeventupdated",b.options)},click:function(){},dblclick:function(a,b){g.editTrackEvent&&g.editTrackEvent(b.options)}});r.addEventListener("mousemove",function(c){e&&(c.pageX-o(a.container)[0]>a.container.offsetLeft-d&&c.pageX-o(a.container)[0]<a.container.offsetLeft-d+a.container.offsetWidth?
g.currentTime((c.pageX-(a.container.offsetLeft-d)+a.container.scrollLeft-o(a.container)[0])/a.container.offsetWidth*a.duration):c.pageX-o(a.container)[0]<=a.container.offsetLeft-d?g.currentTime(0):g.currentTime(a.duration),g.trigger("mediatimeupdate",g,"timeline"))},!1);r.addEventListener("mouseup",function(){e=!1},!1);this.listen("mediatimeupdate",function(){a.scrubber.style.left=g.currentTime()/a.duration*a.container.offsetWidth+"px"});this.listen("trackadded",function(c){var c=c.data,b=a.trackLine.createTrack();
a.trackLinerTracks[c.getId()]=b;a.lastTrack=b;a.butterTracks[b.id()]=c});this.listen("trackremoved",function(c){var c=c.data,b=a.trackLinerTracks[c.getId()],d=b.getTrackEvents(),e;for(e in d)d.hasOwnProperty(e)&&g.removeTrackEvent(c,a.butterTrackEvents[d[e].element.id]);a.trackLine.removeTrack(b);delete a.butterTracks[b.id()];delete a.trackLinerTracks[c.getId()]});this.listen("trackeventadded",function(c){var c=c.data,b=a.lastTrack.createTrackEvent("butterapp",c);a.trackLinerTrackEvents[c.getId()]=
b;a.butterTrackEvents[b.element.id]=c});this.listen("trackeventremoved",function(c){var c=c.data,b=a.trackLinerTrackEvents[c.getId()],d=a.trackLine.getTrack(b.trackId);(a.lastTrack=d)&&d.removeTrackEvent(b.element.id);delete a.butterTrackEvents[b.element.id];delete a.trackLinerTrackEvents[c.getId()]});var w=this;this.listen("mediaadded",function(a){m[a.data.getId()]=new j(a.data)});this.listen("mediaready",function(a){m[a.data.getId()].init();w.trigger("timelineready",{},"timeline")});this.listen("mediachanged",
function(c){a&&a.hide();(a=m[c.data.getId()])&&a.show();w.trigger("timelineready",{},"timeline")});this.listen("mediaremoved",function(a){delete m[a.data.getId()]});this.listen("trackeventupdated",function(c){var c=c.data,b=a.trackLinerTrackEvents[c.getId()];trackLinerTrack=a.trackLine.getTrack(b.trackId);delete a.butterTrackEvents[b.element.id];trackLinerTrack.removeTrackEvent(b.element.id);b=trackLinerTrack.createTrackEvent("butterapp",c);a.butterTrackEvents[b.element.id]=c;a.trackLinerTrackEvents[c.getId()]=
b})})})(window,window.document,Butter);
